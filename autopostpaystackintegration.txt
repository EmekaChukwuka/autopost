Here's the complete **Paystack payment integration** for AutoPost:

## Frontend Implementation

### 1. HTML Payment Component (`payment.html`)
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - AutoPost</title>
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <style>
        :root {
            --primary-blue: #2962FF;
            --white: #ffffff;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-500: #6c757d;
            --gray-800: #343a40;
            --success: #28a745;
            --danger: #dc3545;
        }

        .payment-container {
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .plan-card {
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .plan-card.selected {
            border-color: var(--primary-blue);
            background-color: rgba(41, 98, 255, 0.05);
        }

        .plan-price {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-blue);
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .payment-method {
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-method:hover {
            border-color: var(--primary-blue);
        }

        .payment-method.selected {
            border-color: var(--primary-blue);
            background-color: rgba(41, 98, 255, 0.05);
        }

        .payment-method img {
            height: 40px;
            margin-bottom: 0.5rem;
        }

        .pay-btn {
            width: 100%;
            padding: 1rem;
            background-color: var(--primary-blue);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .pay-btn:hover {
            opacity: 0.9;
        }

        .pay-btn:disabled {
            background-color: var(--gray-500);
            cursor: not-allowed;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--white);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="payment-container">
        <h1>Upgrade Your AutoPost Plan</h1>
        
        <div class="plan-card selected" data-plan="pro">
            <h3>Pro Plan</h3>
            <div class="plan-price">â‚¦2,500</div>
            <p>per month</p>
            <ul>
                <li>10 social accounts</li>
                <li>Unlimited posts</li>
                <li>AI content generator</li>
                <li>Advanced analytics</li>
            </ul>
        </div>

        <h3>Select Payment Method</h3>
        <div class="payment-methods">
            <div class="payment-method selected" data-method="card">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzI5NjJGRiIvPgo8dGV4dCB4PSIyMCIgeT0iMjUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5DYXJkPC90ZXh0Pgo8L3N2Zz4=" alt="Card">
                <span>Card</span>
            </div>
            
            <div class="payment-method" data-method="bank">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzZDNzdGRiIvPgo8dGV4dCB4PSIyMCIgeT0iMjUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5CYW5rPC90ZXh0Pgo8L3N2Zz4=" alt="Bank Transfer">
                <span>Bank Transfer</span>
            </div>
            
            <div class="payment-method" data-method="ussd">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzM0QTQwIi8+Cjx0ZXh0IHg9IjIwIiB5PSIyNSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlVTRFM8L3RleHQ+Cjwvc3ZnPg==" alt="USSD">
                <span>USSD</span>
            </div>
        </div>

        <button id="payButton" class="pay-btn">
            Pay Now - â‚¦2,500
        </button>
    </div>

    <script>
        let selectedMethod = 'card';
        const plan = { id: 'pro', amount: 2500, name: 'Pro Plan' };

        // Payment method selection
        document.querySelectorAll('.payment-method').forEach(method => {
            method.addEventListener('click', () => {
                document.querySelectorAll('.payment-method').forEach(m => 
                    m.classList.remove('selected'));
                method.classList.add('selected');
                selectedMethod = method.dataset.method;
            });
        });

        // Payment initialization
        document.getElementById('payButton').addEventListener('click', async () => {
            const btn = document.getElementById('payButton');
            btn.innerHTML = '<div class="loading"></div> Processing...';
            btn.disabled = true;

            try {
                // Initialize payment with backend
                const response = await fetch('/api/payments/initialize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        plan: plan.id,
                        amount: plan.amount,
                        payment_method: selectedMethod
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Launch Paystack payment modal
                    makePayment(data.data);
                } else {
                    alert('Payment initialization failed: ' + data.message);
                    resetButton();
                }
            } catch (error) {
                console.error('Payment error:', error);
                alert('Payment failed. Please try again.');
                resetButton();
            }
        });

        function makePayment(paymentData) {
            const handler = PaystackPop.setup({
                key: paymentData.public_key,
                email: paymentData.email,
                amount: paymentData.amount,
                currency: paymentData.currency,
                ref: paymentData.reference,
                metadata: paymentData.metadata,
                channels: [selectedMethod],
                
                onClose: function() {
                    resetButton();
                },
                
                callback: function(response) {
                    verifyPayment(response.reference);
                }
            });
            
            handler.openIframe();
        }

        async function verifyPayment(reference) {
            try {
                const response = await fetch('/api/payments/verify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    credentials: 'include',
                    body: JSON.stringify({ reference: reference })
                });

                const data = await response.json();

                if (data.success) {
                    alert('Payment successful! Your account has been upgraded.');
                    window.location.href = '/dashboard';
                } else {
                    alert('Payment verification failed: ' + data.message);
                    resetButton();
                }
            } catch (error) {
                console.error('Verification error:', error);
                alert('Payment verification failed. Please contact support.');
                resetButton();
            }
        }

        function resetButton() {
            const btn = document.getElementById('payButton');
            btn.innerHTML = 'Pay Now - â‚¦2,500';
            btn.disabled = false;
        }
    </script>
</body>
</html>
```

## Backend Implementation

### 2. Payment Routes (`routes/paymentRoutes.js`)
```javascript
import express from 'express';
import { PaymentController } from '../controllers/paymentController.js';
import { requireAuth } from '../middlewares/authMiddleware.js';

const router = express.Router();

router.post('/initialize', requireAuth, PaymentController.initializePayment);
router.post('/verify', requireAuth, PaymentController.verifyPayment);
router.post('/webhook', PaymentController.handleWebhook);
router.get('/plans', PaymentController.getSubscriptionPlans);

export default router;
```

### 3. Payment Controller (`controllers/paymentController.js`)
```javascript
import axios from 'axios';
import { pool } from '../config/db.js';

const PAYSTACK_BASE_URL = 'https://api.paystack.co';

export class PaymentController {
  static async initializePayment(req, res) {
    try {
      const { plan, amount, payment_method } = req.body;
      const userId = req.session.user.id;
      const userEmail = req.session.user.email;

      // Generate unique reference
      const reference = `AUTOPOST_${Date.now()}_${userId}`;

      // Prepare Paystack payment data
      const paymentData = {
        email: userEmail,
        amount: amount * 100, // Paystack expects amount in kobo
        currency: 'NGN',
        reference: reference,
        channels: [payment_method],
        metadata: {
          plan: plan,
          user_id: userId,
          custom_fields: [
            {
              display_name: "Plan Name",
              variable_name: "plan_name",
              value: plan
            }
          ]
        }
      };

      // Initialize payment with Paystack
      const response = await axios.post(
        `${PAYSTACK_BASE_URL}/transaction/initialize`,
        paymentData,
        {
          headers: {
            Authorization: `Bearer ${process.env.PAYSTACK_SECRET_KEY}`,
            'Content-Type': 'application/json'
          }
        }
      );

      // Store transaction in database
      await pool.execute(
        `INSERT INTO transactions 
         (user_id, amount, currency, plan, reference, status, payment_method) 
         VALUES (?, ?, ?, ?, ?, ?, ?)`,
        [userId, amount, 'NGN', plan, reference, 'initiated', payment_method]
      );

      res.json({
        success: true,
        message: 'Payment initialized',
        data: {
          authorization_url: response.data.data.authorization_url,
          access_code: response.data.data.access_code,
          reference: reference,
          public_key: process.env.PAYSTACK_PUBLIC_KEY,
          email: userEmail,
          amount: amount,
          currency: 'NGN',
          metadata: paymentData.metadata
        }
      });

    } catch (error) {
      console.error('Payment initialization error:', error.response?.data || error.message);
      res.status(500).json({
        success: false,
        message: 'Payment initialization failed'
      });
    }
  }

  static async verifyPayment(req, res) {
    try {
      const { reference } = req.body;
      const userId = req.session.user.id;

      // Verify payment with Paystack
      const response = await axios.get(
        `${PAYSTACK_BASE_URL}/transaction/verify/${reference}`,
        {
          headers: {
            Authorization: `Bearer ${process.env.PAYSTACK_SECRET_KEY}`
          }
        }
      );

      const transaction = response.data.data;

      if (transaction.status === 'success') {
        // Update transaction status
        await pool.execute(
          `UPDATE transactions SET 
           status = 'completed', 
           paystack_id = ?,
           updated_at = NOW()
           WHERE reference = ? AND user_id = ?`,
          [transaction.id, reference, userId]
        );

        // Update user subscription
        await pool.execute(
          `UPDATE users SET 
           subscription_plan = ?,
           subscription_status = 'active',
           subscription_end = DATE_ADD(NOW(), INTERVAL 1 MONTH)
           WHERE id = ?`,
          [transaction.metadata.plan, userId]
        );

        res.json({
          success: true,
          message: 'Payment verified successfully',
          data: transaction
        });
      } else {
        await pool.execute(
          `UPDATE transactions SET status = 'failed' WHERE reference = ?`,
          [reference]
        );

        res.status(400).json({
          success: false,
          message: 'Payment verification failed'
        });
      }
    } catch (error) {
      console.error('Payment verification error:', error.response?.data || error.message);
      res.status(500).json({
        success: false,
        message: 'Payment verification failed'
      });
    }
  }

  static async handleWebhook(req, res) {
    try {
      // Verify webhook signature
      const secret = process.env.PAYSTACK_WEBHOOK_SECRET;
      const signature = req.headers['x-paystack-signature'];
      
      if (!signature) {
        return res.status(401).json({ error: 'No signature provided' });
      }

      // Verify signature (you'd need to implement crypto verification)
      const crypto = await import('crypto');
      const hash = crypto.createHmac('sha512', secret)
        .update(JSON.stringify(req.body))
        .digest('hex');
      
      if (hash !== signature) {
        return res.status(401).json({ error: 'Invalid signature' });
      }

      const event = req.body;
      
      if (event.event === 'charge.success') {
        const transaction = event.data;

        await pool.execute(
          `UPDATE transactions SET 
           status = 'completed',
           paystack_id = ?,
           updated_at = NOW()
           WHERE reference = ?`,
          [transaction.id, transaction.reference]
        );

        // Update user subscription
        if (transaction.metadata && transaction.metadata.user_id) {
          await pool.execute(
            `UPDATE users SET 
             subscription_plan = ?,
             subscription_status = 'active',
             subscription_end = DATE_ADD(NOW(), INTERVAL 1 MONTH)
             WHERE id = ?`,
            [transaction.metadata.plan, transaction.metadata.user_id]
          );
        }
      }

      res.status(200).json({ received: true });
    } catch (error) {
      console.error('Webhook error:', error);
      res.status(500).json({ error: 'Webhook processing failed' });
    }
  }

  static async getSubscriptionPlans(req, res) {
    try {
      const [plans] = await pool.execute(
        `SELECT id, name, price, duration, features 
         FROM subscription_plans 
         WHERE active = true 
         ORDER BY price ASC`
      );

      res.json({
        success: true,
        data: plans
      });
    } catch (error) {
      console.error('Get plans error:', error);
      res.status(500).json({
        success: false,
        message: 'Failed to fetch plans'
      });
    }
  }

  static async createSubscription(req, res) {
    try {
      const { plan, amount, interval } = req.body;
      const userId = req.session.user.id;
      const userEmail = req.session.user.email;

      const response = await axios.post(
        `${PAYSTACK_BASE_URL}/plan`,
        {
          name: `AutoPost ${plan} Plan`,
          amount: amount * 100,
          interval: interval || 'monthly',
          currency: 'NGN'
        },
        {
          headers: {
            Authorization: `Bearer ${process.env.PAYSTACK_SECRET_KEY}`
          }
        }
      );

      const planCode = response.data.data.plan_code;

      // Create subscription
      const subscriptionResponse = await axios.post(
        `${PAYSTACK_BASE_URL}/subscription`,
        {
          customer: userEmail,
          plan: planCode,
          authorization: req.body.authorization_code
        },
        {
          headers: {
            Authorization: `Bearer ${process.env.PAYSTACK_SECRET_KEY}`
          }
        }
      );

      res.json({
        success: true,
        data: subscriptionResponse.data.data
      });

    } catch (error) {
      console.error('Create subscription error:', error.response?.data || error.message);
      res.status(500).json({
        success: false,
        message: 'Subscription creation failed'
      });
    }
  }
}
```

### 4. Database Schema (`sql/payment_tables.sql`)
```sql
CREATE TABLE IF NOT EXISTS transactions (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  amount DECIMAL(10, 2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'NGN',
  plan VARCHAR(50) NOT NULL,
  reference VARCHAR(255) NOT NULL UNIQUE,
  paystack_id VARCHAR(255),
  status ENUM('initiated', 'pending', 'completed', 'failed') DEFAULT 'initiated',
  payment_method VARCHAR(50) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS subscription_plans (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  price DECIMAL(10, 2) NOT NULL,
  duration INT DEFAULT 30 COMMENT 'Duration in days',
  features JSON,
  active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO subscription_plans (name, description, price, duration, features) VALUES
('Basic', 'Essential features for starters', 1000, 30, '["3 social accounts", "100 posts/month", "Basic analytics"]'),
('Pro', 'For serious content creators', 2500, 30, '["10 social accounts", "Unlimited posts", "AI content generator", "Advanced analytics"]'),
('Business', 'For agencies and teams', 5000, 30, '["Unlimited accounts", "Team members", "Priority support", "White-label reports"]');

ALTER TABLE users 
ADD COLUMN subscription_plan VARCHAR(50) DEFAULT NULL,
ADD COLUMN subscription_status ENUM('active', 'inactive', 'canceled') DEFAULT 'inactive',
ADD COLUMN subscription_end TIMESTAMP NULL DEFAULT NULL;
```

### 5. Environment Variables (`.env`)
```env
PAYSTACK_PUBLIC_KEY=pk_test_your_public_key_here
PAYSTACK_SECRET_KEY=sk_test_your_secret_key_here
PAYSTACK_WEBHOOK_SECRET=your_webhook_secret_here
```

### 6. Package.json Dependencies
```json
{
  "dependencies": {
    "axios": "^1.4.0"
  }
}
```

## ðŸš€ Setup Instructions:

1. **Create Paystack Account**:
   - Sign up at [Paystack Dashboard](https://dashboard.paystack.com/)
   - Get your API keys from Settings â†’ API Keys & Webhooks

2. **Setup Webhooks**:
   - In Paystack dashboard: Settings â†’ Webhooks
   - Add endpoint: `https://yourdomain.com/api/payments/webhook`
   - Set secret (store in `.env` as `PAYSTACK_WEBHOOK_SECRET`)

3. **Run Database Setup**:
```bash
mysql -u root -p < sql/payment_tables.sql
```

4. **Update Server.js**:
```javascript
// Add payment routes to your server
import paymentRoutes from './routes/paymentRoutes.js';
app.use('/api/payments', paymentRoutes);
```

5. **Start Your Server**:
```bash
npm run dev
```

## ðŸ’° Paystack Fee Structure:
- **Transaction Fee**: 1.5% + â‚¦100 per transaction
- **No Setup Fees**: Completely free to integrate
- **No Monthly Fees**: Only pay when you receive payments

## ðŸŽ¯ Key Features:
- âœ… Card payments (Visa, Mastercard, Verve)
- âœ… Bank transfers
- âœ… USSD payments
- âœ… Mobile money
- âœ… Subscription management
- âœ… Webhook support
- âœ… Excellent Nigerian bank coverage

This Paystack integration provides a robust payment solution specifically optimized for the Nigerian market with better bank coverage and lower fees than many alternatives.